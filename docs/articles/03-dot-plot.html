<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>03 - Visualize The Topology of a Panicle • ptrapr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="03 - Visualize The Topology of a Panicle">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ptrapr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01-load-files.html">01 - Load Panicles Files Into R</a>
    </li>
    <li>
      <a href="../articles/02-why-invert-edges.html">02 - Why and How to Invert Edges</a>
    </li>
    <li>
      <a href="../articles/03-dot-plot.html">03 - Visualize The Topology of a Panicle</a>
    </li>
    <li>
      <a href="../articles/04-visualize-many-panicles-loop-r.html">04 - Visualize Many Panicles at Once With a Loop</a>
    </li>
    <li>
      <a href="../articles/05-extract-features.html">05 - Extract and Save Basic Panicle Features</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/othomantegazza/ptrapr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>03 - Visualize The Topology of a Panicle</h1>
                        <h4 class="author">Otho Mantegazza</h4>
            
            <h4 class="date">2019-02-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/othomantegazza/ptrapr/blob/master/vignettes/03-dot-plot.Rmd"><code>vignettes/03-dot-plot.Rmd</code></a></small>
      <div class="hidden name"><code>03-dot-plot.Rmd</code></div>

    </div>

    
    
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="kw">library</span>(magrittr)
<span class="kw">library</span>(igraph)
<span class="kw">library</span>(ggraph)
<span class="kw">library</span>(ptrapr)
<span class="kw">library</span>(forcats)
<span class="kw">library</span>(stringr)

<span class="co"># panicle graphs look better with ggplot2's theme minimal</span>
<span class="kw">theme_set</span>(<span class="kw">theme_minimal</span>())</code></pre></div>
</div>
<div id="intro-get-data" class="section level1">
<h1 class="hasAnchor">
<a href="#intro-get-data" class="anchor"></a>Intro / get data</h1>
<p>In this Vignette you will learn how to visualize the panicle stucture, with some simple plots that highlight important features such as the number of spikelets, the number of branches and their topology.</p>
<p>We provide the R objects <code>good_panicle</code> and <code>inverted_panicle</code> which store a panicle graph that has been already parsed in R. If you want to learn how to parse panicle XML files, please read the Vignette “Load Panicles into R”.</p>
<p>Access sample panicle data with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(good_panicle)
<span class="kw">data</span>(inverted_panicle)</code></pre></div>
<p>Before you use the panicle graph in <code>inverted_panicle</code>, you must invert it with <code><a href="../reference/invert_edges.html">invert_edges()</a></code>.</p>
</div>
<div id="plot-the-panicle-graph" class="section level1">
<h1 class="hasAnchor">
<a href="#plot-the-panicle-graph" class="anchor"></a>Plot the Panicle Graph</h1>
<p>The most basic way to inspect a panicle graph by plotting it with the functions provided by <code>ggraph</code>.</p>
<p>We provide a wrapper in the function <code><a href="../reference/plot_panicle.html">plot_panicle()</a></code>, this is what that function does and how you can adjust the resulting plot. The function <code><a href="../reference/plot_panicle.html">plot_panicle()</a></code> plots a panicle graph with the functions <code><a href="http://www.rdocumentation.org/packages/ggraph/topics/ggraph">ggraph()</a></code>, <code><a href="http://www.rdocumentation.org/packages/ggraph/topics/geom_edge_link">geom_edge_link()</a></code> and <code><a href="http://www.rdocumentation.org/packages/ggraph/topics/geom_node_point">geom_node_point()</a></code>; see those elements in action below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># set a basic point size to represent the nodes,</span>
<span class="co"># so that the graph elements (nodes and edges)</span>
<span class="co"># do not overlap with each others.</span>
point_size &lt;-<span class="st"> </span><span class="fl">1.8</span>

good_panicle <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggraph/topics/ggraph">ggraph</a></span>(<span class="dt">layout =</span> <span class="st">"nicely"</span>) <span class="op">+</span><span class="st"> </span><span class="co"># nicely is just a default layout</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggraph/topics/geom_edge_link">geom_edge_link</a></span>(
    <span class="dt">arrow =</span> grid<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/grid/topics/arrow">arrow</a></span>(    <span class="co"># represent edges as arrows</span>
      <span class="dt">length =</span> grid<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/grid/topics/unit">unit</a></span>(<span class="fl">0.06</span>, <span class="st">"inches"</span>),
      <span class="dt">type =</span> <span class="st">"closed"</span>),
    <span class="dt">colour =</span> <span class="st">"grey30"</span>, <span class="co"># set a nice colour for the edges</span>
    <span class="dt">end_cap =</span> ggraph<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggraph/topics/geometry">circle</a></span>(point_size<span class="op">/</span><span class="dv">2</span>, <span class="st">"mm"</span>),  <span class="co"># thanks to the parameters end_cap and</span>
    <span class="dt">start_cap =</span> ggraph<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggraph/topics/geometry">circle</a></span>(point_size<span class="op">/</span><span class="dv">2</span>, <span class="st">"mm"</span>) <span class="co"># start_cap, the edge arrows do not </span>
                                                   <span class="co"># overlap with the nodes</span>
  ) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggraph/topics/geom_node_point">geom_node_point</a></span>( <span class="co"># represent the nodes as points</span>
      ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span>(<span class="dt">colour =</span> <span class="st">"type"</span>), <span class="co"># colours as node hierarchy (primary etc.)</span>
      <span class="dt">size =</span> point_size,
      <span class="dt">alpha =</span>.<span class="dv">9</span>)  <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_fixed</span>() <span class="co"># fix x and y ratio, since the coordinates are real measurements</span></code></pre></div>
<p><img src="03-dot-plot_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div id="inspect-branching-with-a-dot-plot" class="section level1">
<h1 class="hasAnchor">
<a href="#inspect-branching-with-a-dot-plot" class="anchor"></a>Inspect Branching with a Dot Plot</h1>
<p>In order to visualize and inspect primary and secondary branching, we suggest you to represent your data with a tile plot. We have learned about this representation in <a href="https://www.nature.com/articles/s41598-018-30395-9">this paper by Fujishiro et al.</a>. We suggest this plot because it highlights the number and position of primary and secondary branches in a direct and intuitive way.</p>
<p>To achieve this, first you will have to extract features from the panicle graph and put them in a data frame</p>
<div id="extract-a-data-frame-from-the-graph-with-panicle_tibble" class="section level2">
<h2 class="hasAnchor">
<a href="#extract-a-data-frame-from-the-graph-with-panicle_tibble" class="anchor"></a>Extract a data frame from the graph with panicle_tibble()</h2>
<p>To extract data from a panicle graph and store it in a convenient dataframe, we provide the <code><a href="../reference/panicle_tibble.html">panicle_tibble()</a></code> function. You can use it this way:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pan_tibble &lt;-<span class="st"> </span>
<span class="st">  </span>good_panicle <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/panicle_tibble.html">panicle_tibble</a></span>()</code></pre></div>
<p>You can use the <code><a href="../reference/panicle_tibble.html">panicle_tibble()</a></code> function to get panicle features stored in a dataframe. This dataframe stores each node of the original panicle in the rows and it has four columns, corresponding to 4 different features:</p>
<ul>
<li>
<strong><code>type</code></strong>: Along that primary branch, the identity of each node. (Secondary, Spikelet or End).</li>
<li>
<strong><code>nodes_downstream</code></strong>: how many nodes are downstream that node.</li>
<li>
<strong><code>secondary_rank</code></strong>: the rank of that node along the primary branch on which that nodes sits. Starting fro, the base of that branch.</li>
<li>
<strong><code>primary_rank</code></strong>: the rank of the primary branch on which that node sits (primary branches are ranked along the rachis starting from the base of the panicle).</li>
</ul>
</div>
</div>
<div id="visulize-with-a-tileplot" class="section level1">
<h1 class="hasAnchor">
<a href="#visulize-with-a-tileplot" class="anchor"></a>Visulize with a tileplot</h1>
<p>This dataframe is ready to be visualized with <code>ggplot2</code>.</p>
<p>We provide the function <code><a href="../reference/panicle_tileplot.html">panicle_tileplot()</a></code> to plot panicle topology. But we strongly suggest that you design your own plotting functions. Only by designing your own plot function your graphical visualization will be versatile enough to let you explore multiple panicle datasets.</p>
<p>Here we provide some examples:</p>
<p><code>panicle_tileplot</code> is just a wrapper around ggplot2, this is how it works.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span>
<span class="st">  </span>pan_tibble <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> secondary_rank,
             <span class="dt">y =</span> primary_rank,
             <span class="dt">fill =</span> type)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_tile</span>(<span class="dt">colour =</span> <span class="st">"grey80"</span>,
            <span class="dt">size =</span> <span class="dv">2</span>) 

p</code></pre></div>
<p><img src="03-dot-plot_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>You can update the plot and display the number of nodes (Spikelets and tertiary branches) downstream a secondary branch node</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p2 &lt;-<span class="st"> </span>p <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">              </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type <span class="op">==</span><span class="st"> "Seconday"</span>), <span class="co"># Show the number for secondary nodes</span>
            <span class="kw">aes</span>(<span class="dt">label =</span> nodes_downstream),
            <span class="dt">colour =</span> <span class="st">"grey40"</span>,
            <span class="dt">fontface =</span> <span class="st">"bold"</span>)

p2</code></pre></div>
<p><img src="03-dot-plot_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Above we map the colors to the node type (End, Secondary, Spikelet), but you can also map the colors to the number nodes produced by secondary branches.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p3 &lt;-<span class="st"> </span>
<span class="st">  </span>pan_tibble <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># use as.character %&gt;% as_factor() to turn a continuous variable</span>
<span class="st">  </span><span class="co"># into a categorical one.</span>
<span class="st">  </span><span class="co"># because node ranks look better if plotted as categorical</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> secondary_rank <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.character</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/forcats/topics/as_factor">as_factor</a></span>(),
             <span class="dt">y =</span> primary_rank <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.character</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/forcats/topics/as_factor">as_factor</a></span>(),
             <span class="dt">fill =</span> nodes_downstream)) <span class="op">+</span><span class="st"> </span><span class="co"># nodes on 2ndary branches to fill colours</span>
<span class="st">  </span><span class="kw">geom_tile</span>(<span class="dt">colour =</span> <span class="st">"grey80"</span>,
            <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">              </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(type <span class="op">==</span><span class="st"> "Seconday"</span>), <span class="co"># Show the number for secondary nodes</span>
            <span class="kw">aes</span>(<span class="dt">label =</span> nodes_downstream),
            <span class="dt">colour =</span> <span class="st">"grey30"</span>,
            <span class="dt">fontface =</span> <span class="st">"bold"</span>,
            <span class="dt">size =</span> <span class="dv">5</span>) <span class="op">+</span>
<span class="st">  </span><span class="co"># fixed xy ratio, each tile is a square</span>
<span class="st">  </span><span class="kw">coord_fixed</span>() <span class="op">+</span>
<span class="st">  </span><span class="co"># set scale of colours and</span>
<span class="st">  </span><span class="co"># proper labels for the colour scales</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggraph/topics/reexports">scale_fill_viridis</a></span>(<span class="dt">breaks =</span> <span class="cf">function</span>(limits) <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">:</span><span class="kw">max</span>(limits)), 
                     <span class="dt">labels =</span> <span class="cf">function</span>(breaks) <span class="kw"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(breaks <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> "1</span><span class="ch">\n</span><span class="st">[Spikelet]"</span>,
                                                         <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="kw">as.character</span>(breaks)),
                     <span class="dt">guide =</span> <span class="kw">guide_legend</span>(<span class="dt">nrow =</span> <span class="dv">1</span>, 
                                          <span class="dt">keyheight =</span> <span class="kw">unit</span>(<span class="dv">7</span>, <span class="dt">units =</span> <span class="st">"mm"</span>),
                                          <span class="dt">keywidth=</span><span class="kw">unit</span>(<span class="dv">7</span>, <span class="dt">units =</span> <span class="st">"mm"</span>),
                                          <span class="dt">override.aes =</span> <span class="kw">list</span>(<span class="dt">size =</span> <span class="dv">0</span>))) <span class="op">+</span>
<span class="st">   </span><span class="co"># fill guide on top</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"top"</span>) <span class="op">+</span>
<span class="st">  </span><span class="co"># Clear axis names</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Nodes rank along primary branches"</span>,
       <span class="dt">y =</span> <span class="st">"Rank along the rachis"</span>,
       <span class="dt">fill =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/stringr/topics/str_wrap">str_wrap</a></span>(<span class="st">"Nodes on secondary branch"</span>, <span class="dt">width =</span> <span class="dv">20</span>))
p3</code></pre></div>
<p><img src="03-dot-plot_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#setup">Setup</a></li>
      <li><a href="#intro-get-data">Intro / get data</a></li>
      <li><a href="#plot-the-panicle-graph">Plot the Panicle Graph</a></li>
      <li>
<a href="#inspect-branching-with-a-dot-plot">Inspect Branching with a Dot Plot</a><ul class="nav nav-pills nav-stacked">
<li><a href="#extract-a-data-frame-from-the-graph-with-panicle_tibble">Extract a data frame from the graph with panicle_tibble()</a></li>
      </ul>
</li>
      <li><a href="#visulize-with-a-tileplot">Visulize with a tileplot</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Otho Mantegazza.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
