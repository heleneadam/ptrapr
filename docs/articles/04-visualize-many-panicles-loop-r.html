<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>04 - Visualize Many Panicles at Once With a Loop • ptrapr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="04 - Visualize Many Panicles at Once With a Loop">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ptrapr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01-load-files.html">01 - Load Panicles Files Into R</a>
    </li>
    <li>
      <a href="../articles/02-why-invert-edges.html">02 - Why and How to Invert Edges</a>
    </li>
    <li>
      <a href="../articles/03-dot-plot.html">03 - Visualize The Topology of a Panicle</a>
    </li>
    <li>
      <a href="../articles/04-visualize-many-panicles-loop-r.html">04 - Visualize Many Panicles at Once With a Loop</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/othomantegazza/ptrapr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>04 - Visualize Many Panicles at Once With a Loop</h1>
                        <h4 class="author">Otho Mantegazza</h4>
            
            <h4 class="date">2019-01-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/othomantegazza/ptrapr/blob/master/vignettes/04-visualize-many-panicles-loop-r.Rmd"><code>vignettes/04-visualize-many-panicles-loop-r.Rmd</code></a></small>
      <div class="hidden name"><code>04-visualize-many-panicles-loop-r.Rmd</code></div>

    </div>

    
    
<p>Here you will learn how to visualize the structure and the topology of many panicles with a loop.</p>
<p>There are many ways to achieve this, hereby we provide some ideas on how to do it. Feel free to modify and imporve the workflow that we propose. Feel free also to suggest us how to improve this workflow, to do so, contact us through issues and pull requests.</p>
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>setup</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ptrapr)
<span class="kw">library</span>(magrittr)
<span class="kw">library</span>(stringr)
<span class="kw">library</span>(purrr)
<span class="kw">library</span>(ggraph)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(cowplot)</code></pre></div>
</div>
<div id="place-all-files-in-one-single-folder" class="section level1">
<h1 class="hasAnchor">
<a href="#place-all-files-in-one-single-folder" class="anchor"></a>Place All files in one single folder</h1>
<p>Place the structure files (<code>.ricepr</code>) and their corrispective grain files (<code>ricegr</code>) of all the panicles that you want to analyze in one single folder. For every single panicle the name of the structure file and the name of the gr file must be exaclty the same (obviously beside the extension).</p>
<p>That folder must contain nothing else.</p>
<p>For all the files stored in one folder, we load their name in R in this way:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First record the names of the files</span>
<span class="co"># substitute path_to_folder with the path to your folder</span>
panicle_paths &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">list.files</span>(path_to_folder) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># remove the extension (variable part)</span>
<span class="st">  </span><span class="co"># each panicle has two files with different extension</span>
<span class="st">  </span><span class="kw"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span>(<span class="st">".ricegr|.ricepr"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># store the name of the files without the extension</span>
<span class="st">  </span><span class="kw">unique</span>()

panicle_paths</code></pre></div>
<pre><code>## [1] "1_1_6307" "1_2_6308" "1_3_6309" "2_1_6310" "2_2_6311" "2_3_6312"
## [7] "3_1_6313" "3_2_6314" "3_3_6315"</code></pre>
<p>We find it very useful to store the panicle names in a named object (such a named character vector). In this way the names are preserved through the loops.</p>
<p>Here we use a <code>magrittr</code> trick to pass the LHS (left hand side) argument to the next function in anywhere we want it. To do this, enclose the RHS function in curly brackets and call the LHS with a dot “.”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Store file names in named object, to use them later</span>
panicle_paths &lt;-
<span class="st">  </span>panicle_paths <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>{<span class="kw"><a href="http://www.rdocumentation.org/packages/magrittr/topics/aliases">set_names</a></span>(<span class="dt">x =</span> <span class="kw">paste</span>(path_to_folder, ., <span class="dt">sep =</span> <span class="st">"/"</span>), <span class="dt">nm =</span> .)}</code></pre></div>
</div>
<div id="parse-all-panicles" class="section level1">
<h1 class="hasAnchor">
<a href="#parse-all-panicles" class="anchor"></a>Parse All Panicles</h1>
<p>Afterwards, you can loop the main worflow on the named object <code>panicle_paths</code> with <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code>. This function from the package <code>purrr</code> is convenient because it loops over r objects preserving their names.</p>
<p>Here we show you how build loops over the functions of <code>ptrapr</code> one by one.</p>
<p>First parse and load all the files with <code><a href="../reference/read_full_panicle.html">read_full_panicle()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Parse them in a list, using file name as list names</span>
panicle_list &lt;-<span class="st"> </span>
<span class="st">  </span>panicle_paths <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="op">~</span><span class="kw"><a href="../reference/read_full_panicle.html">read_full_panicle</a></span>(.)) 

<span class="co"># alternative</span>
<span class="co"># panicle_list &lt;- </span>
<span class="co">#   panicle_paths %&gt;%</span>
<span class="co">#   map(~read_full_panicle(</span>
<span class="co">#     pr_file = paste0(., ".ricepr"), </span>
<span class="co">#     gr_file = paste0(., ".ricegr"))</span>
<span class="co">#     ) </span></code></pre></div>
<p>Then correct the edges on the main axis with <code><a href="../reference/invert_edges.html">invert_edges()</a></code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">panicle_list &lt;-<span class="st"> </span>
<span class="st">  </span>panicle_list <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="op">~</span><span class="kw"><a href="../reference/invert_edges.html">invert_edges</a></span>(., <span class="dt">check_before =</span> <span class="ot">TRUE</span>))</code></pre></div>
<p>As you can see, <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> preserves the names of <code>panicle_list</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(panicle_list)</code></pre></div>
<pre><code>## [1] "1_1_6307" "1_2_6308" "1_3_6309" "2_1_6310" "2_2_6311" "2_3_6312"
## [7] "3_1_6313" "3_2_6314" "3_3_6315"</code></pre>
</div>
<div id="plot-all-the-panicles" class="section level1">
<h1 class="hasAnchor">
<a href="#plot-all-the-panicles" class="anchor"></a>Plot All the Panicles</h1>
<p>In this last part we show you how to combine two kind of plots:</p>
<ul>
<li>a <code>panicle_plot()</code> that displays the architecture and structure of the panicle,</li>
<li>and a <code><a href="../reference/panicle_tileplot.html">panicle_tileplot()</a></code> that focuses on the topology of branching.</li>
</ul>
<p>You can combine plots in many ways. Hereby we use the package <a href="https://cran.r-project.org/web/packages/cowplot/vignettes/introduction.html"><code>cowplot</code></a>.</p>
<p>Although we provide the plotting funcitions <code>panicle_plot()</code> and <code><a href="../reference/panicle_tileplot.html">panicle_tileplot()</a></code>, which are based on <code>ggplot2</code> and ggraph, we suggest you that you design your own plotting functions, because only this way you’ll achieve the versatility required for exploratory data analysis. You can learn how to design your own plotting functions in the previous vignettes.</p>
<div id="how-to-wrap-iterate-over-multiple-plot-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-wrap-iterate-over-multiple-plot-functions" class="anchor"></a>How to wrap iterate over multiple plot functions</h2>
<p>So, we want to wrap <code>panicle_plot()</code> and <code><a href="../reference/panicle_tileplot.html">panicle_tileplot()</a></code>into another function, to plot together different panicle visualisations, and we want to loop that wrapper over a list of panicle using the name of the panicle file of as title of the plots.</p>
<p>To use the name as title, you will have to loop over the names of <code>panicle_list</code> instead of the list itself.</p>
<p>(If you want to master details and quirks of loops and iteration in R, you can <a href="https://adv-r.hadley.nz/functionals.html">learn about them in here</a>).</p>
<p>This might be the most difficult part. We draft a the <code>plot_both()</code> function, that returns a plot (grob) list. and we feed that list to cowplot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot_both &lt;-<span class="st"> </span><span class="cf">function</span>(panicle_name,
                      <span class="dt">p_list =</span> panicle_list)
{
  <span class="co"># extract a panicle by name</span>
  panicle &lt;-<span class="st"> </span>p_list[[panicle_name]]
  
  <span class="co"># plot the structure</span>
  panicle_structure_plot &lt;-
<span class="st">    </span>panicle <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="../reference/plot_panicle.html">plot_panicle</a></span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="co"># place the title over the first plot</span>
<span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(panicle_name)
  
  <span class="co"># plot the topology</span>
  panicle_topology_plot &lt;-<span class="st"> </span>
<span class="st">    </span>panicle <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="../reference/panicle_tibble.html">panicle_tibble</a></span>(.) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="../reference/panicle_tileplot2.html">panicle_tileplot2</a></span>() 
    
  panicle <span class="op">%&gt;%</span>
<span class="st">  </span>{<span class="kw">list</span>(panicle_structure_plot <span class="op">%&gt;%</span>
<span class="st">          </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span>(),
        panicle_topology_plot <span class="op">%&gt;%</span>
<span class="st">          </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span>())}
}</code></pre></div>
<p>This is the final loop, that plots everything directly in a multipage pdf object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pdf</span>(<span class="st">"test-panicle-plots.pdf"</span>, <span class="dt">width =</span> <span class="dv">8</span>, <span class="dt">height =</span> <span class="dv">12</span>)

panicle_list <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># loop over names, so that they can be used as plot titles</span>
<span class="st">  </span><span class="kw">names</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(plot_both) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="op">~</span>cowplot<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/cowplot/topics/plot_grid">plot_grid</a></span>(<span class="dt">plotlist =</span> .,
                          <span class="dt">nrow =</span> <span class="dv">2</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">print</span>()

<span class="kw">dev.off</span>()</code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#setup">setup</a></li>
      <li><a href="#place-all-files-in-one-single-folder">Place All files in one single folder</a></li>
      <li><a href="#parse-all-panicles">Parse All Panicles</a></li>
      <li>
<a href="#plot-all-the-panicles">Plot All the Panicles</a><ul class="nav nav-pills nav-stacked">
<li><a href="#how-to-wrap-iterate-over-multiple-plot-functions">How to wrap iterate over multiple plot functions</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Otho Mantegazza.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
